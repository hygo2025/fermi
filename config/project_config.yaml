# =============================================================================
# FERMI - SESSION-BASED RECOMMENDATION BENCHMARK
# Project-wide Configuration (Paper Standard)
# =============================================================================
# Este arquivo define a configuração GLOBAL do benchmark.
# Configurações específicas de modelos ficam em src/configs/{neural,baselines,factorization}/
# =============================================================================

# -----------------------------------------------------------------------------
# DATA CONFIGURATION
# -----------------------------------------------------------------------------
dataset: realestate
data_path: outputs/data/recbole  # RecBole procura: {data_path}/{dataset}/{dataset}.inter

# Raw data paths (para pipeline de preparação)
raw_data:
  events_path: /home/hygo2025/Documents/data/processed_data/enriched_events
  listings_path: /home/hygo2025/Documents/data/processed_data/listings
  output_path: outputs/data/recbole
  
# Data preparation parameters
data_preparation:
  start_date: "2024-03-01"
  end_date: "2024-03-30"  # 30 dias de dados
  min_session_length: 2    # Mínimo de interações por sessão
  max_session_length: 50   # Máximo de interações por sessão
  min_item_freq: 5         # Mínimo de vezes que um item deve aparecer

# -----------------------------------------------------------------------------
# RECBOLE FIELD MAPPINGS (CRITICAL)
# -----------------------------------------------------------------------------
# RecBole espera campos padronizados. Mapeamos nossos campos reais.
USER_ID_FIELD: user_id       # RecBole agrupa por este campo (será session_id)
ITEM_ID_FIELD: item_id
TIME_FIELD: timestamp
SESSION_ID_FIELD: user_id    # Para modelos session-based, user_id = session_id

# Colunas a carregar do arquivo .inter
load_col:
  inter: [user_id, item_id, timestamp]

# -----------------------------------------------------------------------------
# EVALUATION PROTOCOL - TEMPORAL LEAVE-ONE-OUT (PAPER STANDARD)
# -----------------------------------------------------------------------------
# Estratégia: 
#   - Treina com histórico da sessão
#   - Valida com penúltimo item
#   - Testa com último item
# Referência: Session-Based Recommendation papers (RecSys, SIGIR, WWW)
# -----------------------------------------------------------------------------
eval_args:
  split:
    LS: valid_and_test  # Leave-One-Out Split: penúltimo (valid) + último (test)
  order: TO             # Temporal Ordering: ordena por timestamp ANTES do split
  group_by: user        # Agrupa por USER_ID_FIELD (session_id)
  mode: full            # Full ranking: avalia contra todo o catálogo

# -----------------------------------------------------------------------------
# METRICS (Academic Standard)
# -----------------------------------------------------------------------------
metrics: [Recall, MRR, NDCG, Hit]
topk: [5, 10, 20]
valid_metric: MRR@10  # Métrica para early stopping

# -----------------------------------------------------------------------------
# SESSION CONFIGURATION
# -----------------------------------------------------------------------------
MAX_ITEM_LIST_LENGTH: 50  # Comprimento máximo da sequência (crucial para modelos sequenciais)

# -----------------------------------------------------------------------------
# TRAINING DEFAULTS (podem ser sobrescritos por configs específicas)
# -----------------------------------------------------------------------------
epochs: 50
train_batch_size: 2048
eval_batch_size: 4096
learning_rate: 0.001
train_neg_sample_args: ~  # Disable negative sampling (full ranking)

# Early stopping
stopping_step: 10
valid_metric_bigger: true

# -----------------------------------------------------------------------------
# ENVIRONMENT
# -----------------------------------------------------------------------------
device: cuda
gpu_id: 0
seed: 42
state: INFO  # Logging level: INFO, DEBUG, WARNING, ERROR

# Reproducibility
reproducibility: true

# -----------------------------------------------------------------------------
# CHECKPOINT & LOGGING
# -----------------------------------------------------------------------------
checkpoint_dir: outputs/saved
save_dataset: false
save_dataloaders: false
show_progress: true

# Weights & Biases (desabilitado por padrão)
log_wandb: false

# -----------------------------------------------------------------------------
# OUTPUT PATHS
# -----------------------------------------------------------------------------
output:
  results_dir: outputs/results
  logs_dir: outputs/logs
  tensorboard_dir: log_tensorboard
