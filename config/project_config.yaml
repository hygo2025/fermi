# =============================================================================
# Este arquivo define a configuração GLOBAL do benchmark.
# Configurações específicas de modelos ficam em src/configs/{neural,baselines,factorization}/
# =============================================================================

# -----------------------------------------------------------------------------
# DATA CONFIGURATION
# -----------------------------------------------------------------------------
dataset: realestate
data_path: /home/hygo2025/Development/projects/fermi/outputs/data/recbole

raw_data:
  listings_raw_path: /home/hygo2025/Documents/data/listings
  events_raw_path: /home/hygo2025/Documents/data/events
  
  # Processed data paths
  events_processed_path: /home/hygo2025/Documents/data/processed_data/events
  listings_processed_path: /home/hygo2025/Documents/data/processed_data/listings
  sessions_path: /home/hygo2025/Development/projects/fermi/outputs/data/recbole/sessions_for_api.parquet
  
  # Mapping tables
  listing_id_mapping_path: /home/hygo2025/Documents/data/processed_mapping/listing_id_mapping
  user_id_mapping_path: /home/hygo2025/Documents/data/processed_mapping/user_id_mapping
  session_id_mapping_path: /home/hygo2025/Documents/data/processed_mapping/session_id_mapping
  user_sessions_path: /home/hygo2025/Documents/data/processed_mapping/user_sessions
  
  # Events
  events_path: /home/hygo2025/Documents/data/processed_data/events
  listings_path: /home/hygo2025/Documents/data/processed_data/listings
  
  # Output
  output_path: /home/hygo2025/Development/projects/fermi/outputs/data/recbole
  base_path: /home/hygo2025/Documents/data
  
# Data preparation parameters
data_preparation:
  start_date: "2024-03-01"
  end_date: "2024-07-01"  # 30 dias de dados
  min_session_length: 3    # Mínimo de interações por sessão
  max_session_length: 50   # Máximo de interações por sessão
  min_item_freq: 10         # Mínimo de vezes que um item deve aparecer

# -----------------------------------------------------------------------------
# RECBOLE FIELD MAPPINGS (CRITICAL)
# -----------------------------------------------------------------------------
USER_ID_FIELD: user_id       # RecBole agrupa por este campo (será session_id)
ITEM_ID_FIELD: item_id
TIME_FIELD: timestamp
SESSION_ID_FIELD: user_id    # Para modelos session-based, user_id = session_id

# Colunas a carregar do arquivo .inter
load_col:
  inter: [user_id, item_id, timestamp]

# -----------------------------------------------------------------------------
# EVALUATION PROTOCOL - TEMPORAL LEAVE-ONE-OUT
# -----------------------------------------------------------------------------
# Estratégia: 
#   - Treina com histórico da sessão
#   - Valida com penúltimo item
#   - Testa com último item
# -----------------------------------------------------------------------------
eval_args:
  split:
    LS: valid_and_test  # Leave-One-Out Split: penúltimo (valid) + último (test)
  order: TO             # Temporal Ordering: ordena por timestamp ANTES do split
  group_by: user        # Agrupa por USER_ID_FIELD (session_id)
  mode: full            # Full ranking: avalia contra todo o catálogo
  eval_step: 4
#  mode:
#    valid: uni100  # Validação rápida durante treino/tuning
#    test: full     # Teste final rigoroso após escolher melhor modelo
# -----------------------------------------------------------------------------
# METRICS
# -----------------------------------------------------------------------------
metrics: [Recall, MRR, NDCG, Hit]
topk: [5, 10, 20]
valid_metric: MRR@10  # Métrica para early stopping

# -----------------------------------------------------------------------------
# SESSION CONFIGURATION
# -----------------------------------------------------------------------------
MAX_ITEM_LIST_LENGTH: 50

# -----------------------------------------------------------------------------
# TRAINING DEFAULTS
# -----------------------------------------------------------------------------
epochs: 100
train_batch_size: 4096
eval_batch_size: 8192
learning_rate: 0.001
train_neg_sample_args: ~  # Disable negative sampling (full ranking)

# Early stopping
stopping_step: 3
valid_metric_bigger: true

# -----------------------------------------------------------------------------
# ENVIRONMENT
# -----------------------------------------------------------------------------
device: cuda
gpu_id: 0
seed: 42
state: DEBUG

# Reproducibility
reproducibility: true

# -----------------------------------------------------------------------------
# CHECKPOINT & LOGGING
# -----------------------------------------------------------------------------
checkpoint_dir: outputs/saved
save_dataset: false
save_dataloaders: false
show_progress: true

# Logs
log_wandb: false
tensorboard: true

# -----------------------------------------------------------------------------
# OUTPUT PATHS
# -----------------------------------------------------------------------------
output:
  results_dir: outputs/results
  logs_dir: outputs/logs
  tensorboard_dir: log_tensorboard
